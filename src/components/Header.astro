---
import logo from "../assets/logo.svg";

const { pathname } = Astro.url;

// Helper to determine if a link is active. Handles subfolder base path correctly.
const isActive = (href: string) => {
  const normPath = pathname.replace(/\/$/, "");
  const normHref = href.replace(/\/$/, "");

  // Special case for home page
  if (normHref === import.meta.env.BASE_URL?.replace(/\/$/, "")) {
    return normPath === normHref || normPath === `${normHref}/`;
  }

  return normPath === normHref;
};

const navItems = [
  { name: "Inicio", href: `${import.meta.env.BASE_URL}/` },
  { name: "Obras", href: `${import.meta.env.BASE_URL}/obras` },
  {
    name: "Trámites Mercantiles",
    href: `${import.meta.env.BASE_URL}/tramites-mercantiles`,
  },
  {
    name: "Trámites Generales",
    href: `${import.meta.env.BASE_URL}/tramites-generales`,
  },
  { name: "Ubicación", href: `${import.meta.env.BASE_URL}/ubicacion` },
];
---

<header
  id="main-header"
  class="fixed top-0 left-0 w-full z-[100] transition-all duration-500 py-6"
>
  <div class="container mx-auto px-6">
    <div
      class="glass rounded-2xl md:rounded-full px-6 py-0 flex justify-between items-center shadow-2xl shadow-black/5 overflow-hidden"
    >
      <!-- Logo -->
      <a
        href={`${import.meta.env.BASE_URL}/`}
        class="flex items-center group h-16 md:h-20"
      >
        <div class="h-full w-auto flex items-center justify-center px-2">
          <img
            src={logo.src}
            alt="Jimenez de Gante Logo"
            class="h-[120px] md:h-[160px] w-auto max-w-none object-contain group-hover:scale-105 transition-transform duration-500 relative top-1 md:-top-[16px]"
          />
        </div>
      </a>

      <nav class="hidden lg:flex items-center gap-8 py-4">
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class={`text-sm font-semibold tracking-tight transition-all relative group overflow-hidden py-2 ${
                isActive(item.href)
                  ? "text-dark"
                  : "text-slate-600 hover:text-primary"
              }`}
            >
              {item.name}
              <span
                class={`absolute bottom-0 left-0 w-full h-[2px] bg-primary transition-transform duration-300 ${
                  isActive(item.href)
                    ? "translate-x-0"
                    : "translate-x-[-101%] group-hover:translate-x-0"
                }`}
              />
            </a>
          ))
        }
      </nav>

      <div class="flex items-center gap-4">
        <a
          href={`${import.meta.env.BASE_URL}/ubicacion`}
          class="hidden sm:block bg-dark text-white text-xs font-bold uppercase tracking-widest px-6 py-3 rounded-full hover:bg-primary transition-all duration-300 hover:shadow-lg hover:shadow-primary/30"
        >
          Contacto
        </a>

        <!-- Mobile Toggle -->
        <button id="mobile-toggle" class="lg:hidden p-2 text-dark">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-dark/95 backdrop-blur-xl z-[110] flex flex-col p-10 translate-x-full transition-transform duration-500 lg:hidden"
  >
    <div class="flex justify-between items-center mb-16">
      <div class="text-white font-bold text-2xl tracking-tighter">JG</div>
      <button id="mobile-close" class="p-2 text-white/50 hover:text-white">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-8 h-8"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <nav class="flex flex-col gap-6">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class={`text-3xl font-bold transition-all duration-300 ${
              isActive(item.href)
                ? "text-white border-l-4 border-primary pl-4"
                : "text-white/80 hover:text-primary hover:translate-x-4"
            }`}
          >
            {item.name}
          </a>
        ))
      }
      <a
        href={`${import.meta.env.BASE_URL}/ubicacion`}
        class="mt-8 bg-primary text-dark text-center font-bold py-4 rounded-xl text-xl"
      >
        Contacto Directo
      </a>
    </nav>
  </div>
</header>

<script>
  const header = document.getElementById("main-header");
  const toggle = document.getElementById("mobile-toggle");
  const close = document.getElementById("mobile-close");
  const menu = document.getElementById("mobile-menu");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      header?.classList.add("py-3");
    } else {
      header?.classList.remove("py-3");
    }
  });

  const openMenu = () => {
    menu?.classList.remove("translate-x-full");
    document.body.style.overflow = "hidden";
  };

  const closeMenu = () => {
    menu?.classList.add("translate-x-full");
    document.body.style.overflow = "";
  };

  toggle?.addEventListener("click", openMenu);
  close?.addEventListener("click", closeMenu);
</script>
